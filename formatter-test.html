<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C 格式化器测试</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #1e1e1e;
            color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            background-color: #2d2d30;
        }
        
        .test-title {
            color: #569cd6;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .original {
            border-left: 4px solid #f14c4c;
        }
        
        .formatted {
            border-left: 4px solid #4ec9b0;
        }
        
        .label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #cccccc;
        }
        
        button {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #1177bb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>C 语言格式化器测试</h1>
        
        <div class="test-section">
            <div class="test-title">测试 1: 基本代码格式化</div>
            <div class="label">原始代码:</div>
            <div class="code-block original" id="original1">#include <stdio.h>
int main(){
int x=10,y=20;
if(x>y){
printf("x is greater\\n");
}else{
printf("y is greater\\n");
}
return 0;
}</div>
            <button onclick="formatTest1()">格式化</button>
            <div class="label">格式化后:</div>
            <div class="code-block formatted" id="formatted1">点击格式化按钮查看结果</div>
        </div>

        <div class="test-section">
            <div class="test-title">测试 2: 复杂结构</div>
            <div class="label">原始代码:</div>
            <div class="code-block original" id="original2">#include <stdio.h>
struct Node{
int data;
struct Node*next;
};
int main(){
int arr[]={1,2,3,4,5};
for(int i=0;i<5;i++){
if(arr[i]%2==0){
printf("Even: %d\\n",arr[i]);
}else{
printf("Odd: %d\\n",arr[i]);
}
}
return 0;
}</div>
            <button onclick="formatTest2()">格式化</button>
            <div class="label">格式化后:</div>
            <div class="code-block formatted" id="formatted2">点击格式化按钮查看结果</div>
        </div>

        <div class="test-section">
            <div class="test-title">测试 3: 空代码和边界情况</div>
            <button onclick="formatEmptyCode()">测试空代码</button>
            <button onclick="formatWhitespaceOnly()">测试纯空白字符</button>
            <div class="label">结果:</div>
            <div class="code-block formatted" id="formatted3">点击按钮查看结果</div>
        </div>
    </div>

    <script type="module">
        // 由于这是HTML文件，我们需要创建一个简化的格式化器
        // 实际的格式化器在TypeScript中
        
        class SimpleFormatter {
            format(code) {
                if (!code || typeof code !== 'string') {
                    return '';
                }
                
                if (code.trim() === '') {
                    return '';
                }

                try {
                    const lines = code.split('\\n');
                    const formattedLines = [];
                    let indentLevel = 0;

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        
                        if (!line) {
                            formattedLines.push('');
                            continue;
                        }

                        // 处理预处理器指令
                        if (line.startsWith('#')) {
                            formattedLines.push(line);
                            continue;
                        }

                        // 简化的大括号处理
                        const openBraces = (line.match(/\\{/g) || []).length;
                        const closeBraces = (line.match(/\\}/g) || []).length;
                        
                        // 处理关闭大括号的缩进
                        if (closeBraces > 0) {
                            indentLevel = Math.max(0, indentLevel - closeBraces);
                        }

                        // 应用缩进
                        const indent = '    '.repeat(Math.max(0, indentLevel));
                        const processedLine = line.replace(/\\b(if|while|for|switch|return)\\(/g, '$1 (');
                        
                        formattedLines.push(indent + processedLine);

                        // 处理开启大括号的缩进
                        if (openBraces > 0) {
                            indentLevel = indentLevel + openBraces;
                        }
                    }

                    return formattedLines.join('\\n');
                } catch (error) {
                    console.error('格式化过程中出错:', error);
                    return code;
                }
            }
        }

        const formatter = new SimpleFormatter();

        window.formatTest1 = function() {
            const original = document.getElementById('original1').textContent;
            const formatted = formatter.format(original);
            document.getElementById('formatted1').textContent = formatted || '格式化失败';
        };

        window.formatTest2 = function() {
            const original = document.getElementById('original2').textContent;
            const formatted = formatter.format(original);
            document.getElementById('formatted2').textContent = formatted || '格式化失败';
        };

        window.formatEmptyCode = function() {
            const result = formatter.format('');
            document.getElementById('formatted3').textContent = result === '' ? '空字符串 -> 空字符串 ✓' : '测试失败';
        };

        window.formatWhitespaceOnly = function() {
            const result = formatter.format('   \\n  \\n   ');
            document.getElementById('formatted3').textContent = result === '' ? '纯空白字符 -> 空字符串 ✓' : '测试失败';
        };
    </script>
</body>
</html>
